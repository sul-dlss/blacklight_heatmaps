{"version":3,"file":"default.js","sources":["../../../javascript/blacklight_heatmaps/leaflet/basemap_util.js","../../../javascript/blacklight_heatmaps/leaflet/show_view.js","../../../javascript/blacklight_heatmaps/leaflet/index_view.js","../../../javascript/blacklight_heatmaps/core.js","../../../javascript/blacklight_heatmaps/index.js"],"sourcesContent":["import L from \"leaflet\";\n\nconst basemaps = {\n  darkMatter: L.tileLayer(\n    'https://cartodb-basemaps-{s}.global.ssl.fastly.net/dark_all/{z}/{x}/{y}.png', {\n      attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors, &copy; <a href=\"http://cartodb.com/attributions\">CartoDB</a>',\n      maxZoom: 18,\n      worldCopyJump: true,\n      detectRetina: true,\n    }\n  ),\n  positron: L.tileLayer(\n    'https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png', {\n      attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors, &copy; <a href=\"http://cartodb.com/attributions\">CartoDB</a>',\n      maxZoom: 18,\n      worldCopyJump: true,\n      detectRetina: true,\n    }\n  ),\n  'OpenStreetMap.HOT': L.tileLayer(\n    'https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png', {\n      attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a>, Tiles courtesy of <a href=\"http://hot.openstreetmap.org/\" target=\"_blank\">Humanitarian OpenStreetMap Team</a>',\n      maxZoom: 19,\n    }\n  ),\n};\n\nexport const selectBasemap = (basemap) => {\n  return basemap && basemaps[basemap]\n    ? basemaps[basemap]\n    : basemaps.positron;\n};\n","'use strict';\n\nimport { selectBasemap } from 'blacklight_heatmaps/leaflet/basemap_util';\nimport { map, geoJson, marker, Icon } from 'leaflet';\n\nclass ShowView {\n  constructor(el, options) {\n    this.options = options;\n\n    const json = JSON.parse(el.dataset.features);\n\n    // Load leaflet icon images from CDN (used below in L.Icon.Default)\n    // Follow the approach of geoBlacklight; skypack ESM does not host images\n    Icon.Default.imagePath = \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/\";\n\n    const mapInstance = map(el.id).setView([0, 0], 1);\n    selectBasemap(\n      el.dataset.basemapProvider\n    ).addTo(mapInstance);\n\n    const features = geoJson(json, {\n      pointToLayer: (feature, latlng) => {\n        return marker(latlng, {\n          icon: new L.Icon.Default(),\n        });\n      },\n    }).addTo(mapInstance);\n\n    mapInstance.fitBounds(features.getBounds());\n  }\n}\n\nexport default ShowView;","'use strict';\n\nimport \"solr_heatmap\";\nimport \"control_sidebar\";\nimport { selectBasemap } from 'blacklight_heatmaps/leaflet/basemap_util';\nimport { map, point, Util } from 'leaflet';     \n\nclass IndexView {\n  constructor(el, options) {\n    this.options = options;\n\n    const requestUrl = `${el.dataset.searchUrl}&format=heatmaps`;\n    const geometryField = el.dataset.geometryField;\n    const template = el.dataset.sidebarTemplate;\n    const colorRamp = JSON.parse(el.dataset.colorRamp);\n\n    // Blank out page link content first and disable pagination\n    document.querySelectorAll('#sortAndPerPage .page-links').forEach((links) => {\n      links.innerHTML = '';\n    });\n    document.querySelectorAll('ul.pagination').forEach((links) => {\n      links.classList.add('d-none');\n    });\n\n    const mapInstance = map(el.id).setView([0, 0], 1);\n    selectBasemap(\n      el.dataset.basemapProvider\n    ).addTo(mapInstance);\n\n    const solrLayer = L.solrHeatmap(requestUrl, {\n      field: geometryField,\n      maxSampleSize: 50,\n      colors: colorRamp,\n    }).addTo(mapInstance);\n\n    const sidebar = L.control.sidebar('index-map-sidebar', {\n      position: 'right',\n    });\n\n    mapInstance.addControl(sidebar);\n\n    solrLayer.on('click', (e) => {\n      if (!sidebar.isVisible()) {\n        mapInstance.setView(e.latlng);\n      } else {\n        const pointInstance = mapInstance.project(e.latlng);\n        const offset = sidebar.getOffset();\n        const newPoint = point(pointInstance.x - (offset / 2), pointInstance.y);\n        mapInstance.setView(mapInstance.unproject(newPoint));\n      }\n\n      sidebar.show();\n    });\n\n    solrLayer.on('dataAdded', (e) => {\n      if (e.response && e.response.docs) {\n        let html = '';\n        e.response.docs.forEach((value) => {\n          html += Util.template(template, this.format_data(value));\n        });\n\n        sidebar.setContent(html);\n\n        const docCount = e.response.pages.total_count;\n\n        document.querySelectorAll('#sortAndPerPage .page-links').forEach((links) => {\n          links.innerHTML = `${parseInt(docCount).toLocaleString()} ${docCount === 1 ? 'item' : 'items'} found`;\n        });\n      }\n    });\n  }\n\n  pluralize(count, word) {\n    return count === 1 ? word : `${word}s`;\n  }\n\n  format_data(data) {\n    return {\n      title: data?.title,\n      url: `/catalog/${data?.url?.id}`,\n    }\n  }\n}\n\nexport default IndexView;\n","import ShowView from 'blacklight_heatmaps/leaflet/show_view'\nimport IndexView from 'blacklight_heatmaps/leaflet/index_view';\n\n// Initialize on load\nconst initializeMaps = () => {\n  'use strict';\n\n  console.log('initialize maps')\n  document.querySelectorAll('[data-show-map]').forEach(el => {\n    new ShowView(el);\n  });\n\n  document.querySelectorAll('[data-index-map]').forEach(el => {\n    new IndexView(el);\n  });\n};\n\n// Inspired by GeoBlacklight and Blacklight's core.js\nconst BlacklightHeatmaps = (function () {\n    const callbacks = [];\n    return {\n      // Hook: pass a callback to add it to the activation stack\n      onLoad: function (callback) {\n        callbacks.push(callback);\n      },\n  \n      // Activate all stored callbacks\n      activate: function (event) {\n        callbacks.forEach((callback) => {\n          callback(event);\n        });\n      },\n  \n      // Define hooks that will trigger the activation of the BlacklightHeatmaps JS\n      listeners: function () {\n        if (typeof Turbo !== \"undefined\")\n          return [\"turbo:load\", \"turbo:frame-load\"];\n        else return [\"DOMContentLoaded\"];\n      },\n    };\n  })();\n\n  // Add event listeners that call activate() for each event type\n  BlacklightHeatmaps.listeners().forEach((listener) =>\n    document.addEventListener(listener, (event) => BlacklightHeatmaps.activate(event))\n  );\n\n  BlacklightHeatmaps.onLoad(initializeMaps);\n\n\n// Register our Stimulus controllers\nif (typeof Stimulus !== \"undefined\") {\n  console.info(\"Registering BlacklightHeatmaps Stimulus controllers\");\n} else {\n  console.error(\n    \"Couldn't find Stimulus. Check installation instructions at https://github.com/hotwired/stimulus-rails.\"\n  );\n}\n\nexport default BlacklightHeatmaps;\n","import Core from \"blacklight_heatmaps/core\";\n\nexport default {\n    Core,\n    onLoad: Core.onLoad,\n  };\n"],"names":["L","Icon","map","geoJson","marker","point","Util","Core"],"mappings":"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"}