{"version":3,"file":"default.esm.js","sources":["../../../javascript/blacklight_heatmaps/leaflet/basemap_util.js","../../../javascript/blacklight_heatmaps/leaflet/show_view.js","../../../javascript/blacklight_heatmaps/leaflet/index_view.js","../../../javascript/blacklight_heatmaps/core.js","../../../javascript/blacklight_heatmaps/index.js"],"sourcesContent":["import L from \"leaflet\";\n\nconst basemaps = {\n  darkMatter: L.tileLayer(\n    'https://cartodb-basemaps-{s}.global.ssl.fastly.net/dark_all/{z}/{x}/{y}.png', {\n      attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors, &copy; <a href=\"http://cartodb.com/attributions\">CartoDB</a>',\n      maxZoom: 18,\n      worldCopyJump: true,\n      detectRetina: true,\n    }\n  ),\n  positron: L.tileLayer(\n    'https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png', {\n      attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors, &copy; <a href=\"http://cartodb.com/attributions\">CartoDB</a>',\n      maxZoom: 18,\n      worldCopyJump: true,\n      detectRetina: true,\n    }\n  ),\n  'OpenStreetMap.HOT': L.tileLayer(\n    'https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png', {\n      attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a>, Tiles courtesy of <a href=\"http://hot.openstreetmap.org/\" target=\"_blank\">Humanitarian OpenStreetMap Team</a>',\n      maxZoom: 19,\n    }\n  ),\n};\n\nexport const selectBasemap = (basemap) => {\n  return basemap && basemaps[basemap]\n    ? basemaps[basemap]\n    : basemaps.positron;\n};\n","'use strict';\n\nimport { selectBasemap } from 'blacklight_heatmaps/leaflet/basemap_util';\nimport { map, geoJson, marker, Icon } from 'leaflet';\n\nclass ShowView {\n  constructor(el, options) {\n    this.options = options;\n\n    const json = JSON.parse(el.dataset.features);\n\n    // Load leaflet icon images from CDN (used below in L.Icon.Default)\n    // Follow the approach of geoBlacklight; skypack ESM does not host images\n    Icon.Default.imagePath = \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/\";\n\n    const mapInstance = map(el.id).setView([0, 0], 1);\n    selectBasemap(\n      el.dataset.basemapProvider\n    ).addTo(mapInstance);\n\n    const features = geoJson(json, {\n      pointToLayer: (feature, latlng) => {\n        return marker(latlng, {\n          icon: new L.Icon.Default(),\n        });\n      },\n    }).addTo(mapInstance);\n\n    mapInstance.fitBounds(features.getBounds());\n  }\n}\n\nexport default ShowView;","'use strict';\n\nimport \"solr_heatmap\";\nimport \"control_sidebar\";\nimport { selectBasemap } from 'blacklight_heatmaps/leaflet/basemap_util';\nimport { map, point, Util } from 'leaflet';     \n\nclass IndexView {\n  constructor(el, options) {\n    this.options = options;\n\n    const requestUrl = `${el.dataset.searchUrl}&format=heatmaps`;\n    const geometryField = el.dataset.geometryField;\n    const template = el.dataset.sidebarTemplate;\n    const colorRamp = JSON.parse(el.dataset.colorRamp);\n\n    // Blank out page link content first and disable pagination\n    document.querySelectorAll('#sortAndPerPage .page-links').forEach((links) => {\n      links.innerHTML = '';\n    });\n    document.querySelectorAll('ul.pagination').forEach((links) => {\n      links.classList.add('d-none');\n    });\n\n    const mapInstance = map(el.id).setView([0, 0], 1);\n    selectBasemap(\n      el.dataset.basemapProvider\n    ).addTo(mapInstance);\n\n    const solrLayer = L.solrHeatmap(requestUrl, {\n      field: geometryField,\n      maxSampleSize: 50,\n      colors: colorRamp,\n    }).addTo(mapInstance);\n\n    const sidebar = L.control.sidebar('index-map-sidebar', {\n      position: 'right',\n    });\n\n    mapInstance.addControl(sidebar);\n\n    solrLayer.on('click', (e) => {\n      if (!sidebar.isVisible()) {\n        mapInstance.setView(e.latlng);\n      } else {\n        const pointInstance = mapInstance.project(e.latlng);\n        const offset = sidebar.getOffset();\n        const newPoint = point(pointInstance.x - (offset / 2), pointInstance.y);\n        mapInstance.setView(mapInstance.unproject(newPoint));\n      }\n\n      sidebar.show();\n    });\n\n    solrLayer.on('dataAdded', (e) => {\n      if (e.response && e.response.docs) {\n        let html = '';\n        e.response.docs.forEach((value) => {\n          html += Util.template(template, this.format_data(value));\n        });\n\n        sidebar.setContent(html);\n\n        const docCount = e.response.pages.total_count;\n\n        document.querySelectorAll('#sortAndPerPage .page-links').forEach((links) => {\n          links.innerHTML = `${parseInt(docCount).toLocaleString()} ${docCount === 1 ? 'item' : 'items'} found`;\n        });\n      }\n    });\n  }\n\n  pluralize(count, word) {\n    return count === 1 ? word : `${word}s`;\n  }\n\n  format_data(data) {\n    return {\n      title: data?.title,\n      url: `/catalog/${data?.url?.id}`,\n    }\n  }\n}\n\nexport default IndexView;\n","import ShowView from 'blacklight_heatmaps/leaflet/show_view'\nimport IndexView from 'blacklight_heatmaps/leaflet/index_view';\n\n// Initialize on load\nconst initializeMaps = () => {\n  'use strict';\n\n  console.log('initialize maps')\n  document.querySelectorAll('[data-show-map]').forEach(el => {\n    new ShowView(el);\n  });\n\n  document.querySelectorAll('[data-index-map]').forEach(el => {\n    new IndexView(el);\n  });\n};\n\n// Inspired by GeoBlacklight and Blacklight's core.js\nconst BlacklightHeatmaps = (function () {\n    const callbacks = [];\n    return {\n      // Hook: pass a callback to add it to the activation stack\n      onLoad: function (callback) {\n        callbacks.push(callback);\n      },\n  \n      // Activate all stored callbacks\n      activate: function (event) {\n        callbacks.forEach((callback) => {\n          callback(event);\n        });\n      },\n  \n      // Define hooks that will trigger the activation of the BlacklightHeatmaps JS\n      listeners: function () {\n        if (typeof Turbo !== \"undefined\")\n          return [\"turbo:load\", \"turbo:frame-load\"];\n        else return [\"DOMContentLoaded\"];\n      },\n    };\n  })();\n\n  // Add event listeners that call activate() for each event type\n  BlacklightHeatmaps.listeners().forEach((listener) =>\n    document.addEventListener(listener, (event) => BlacklightHeatmaps.activate(event))\n  );\n\n  BlacklightHeatmaps.onLoad(initializeMaps);\n\n\n// Register our Stimulus controllers\nif (typeof Stimulus !== \"undefined\") {\n  console.info(\"Registering BlacklightHeatmaps Stimulus controllers\");\n} else {\n  console.error(\n    \"Couldn't find Stimulus. Check installation instructions at https://github.com/hotwired/stimulus-rails.\"\n  );\n}\n\nexport default BlacklightHeatmaps;\n","import Core from \"blacklight_heatmaps/core\";\n\nexport default {\n    Core,\n    onLoad: Core.onLoad,\n  };\n"],"names":["L","Core"],"mappings":"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"}